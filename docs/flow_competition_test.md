## The complex topology

The required topology for flow competition test is as follows:

```text
[h0]    ---------competition flow -----\
[h1]    ---------competition flow -----\
                                       |
[target protocol sender]--------------->[Router0]------------>[Router1]------ >  [target protocol receiver]
                                                                 |
                                                                  \-------------> [h0']
                                                                   \------------> [h1']
```

The test case configuration is as follows:

```yaml
tests:
  test1:
    description: "Flow competition test with multiple protocols"
    topology:
      config_name: complex_mesh_net
      config_file: predefined.topology.yaml
    target_protocols: [tcp-bbr]
    route: static_bfs
    test_tools:
      iperf:
        interval: 1
        interval_num: 10
        packet_type: tcp
        client_host: 2
        server_host: 5
    competition_flows:
      - flow_type: tcp # flow type
        client_host: 0 # the source node of the flow.
        server_host: 6 # the sink node the of flow.
        delay: 10 # the flow will be generated by delay 10 seconds.
        duration: 10 # the flow will last for 10 seconds.
```

The configuration examples are in `src/config/protocol-flow-competition-test.yaml`.

- Supported `flow_type` in `competition_flows` section:
  - tcp (flow generated by iperf3)
  - btp (flow generated by bats_iperf)
  - brtp (flow generated by bats_iperf)
  - [protocol]-[cc]: tcp-bbr, tcp-cubic
  
- Supported `test_tools` which has no conflicts with `competition_flows`:
  - iperf
  - bats_iperf

### **Node Mapping**
- 0: h0
- 1: h1
- 2: target protocol sender
- 3: Router0
- 4: Router1
- 5: target protocol receiver
- 6: h0'
- 7: h1'

### **Connections (bidirectional):**

- h0 (0) ↔ Router0 (3)
- h1 (1) ↔ Router0 (3)
- target protocol sender (2) ↔ Router0 (3)
- Router0 (3) ↔ Router1 (4)
- Router1 (4) ↔ target protocol receiver (5)
- Router1 (4) ↔ h0' (6)
- Router1 (4) ↔ h1' (7)

### **Adjacency Matrix (8x8):**

```yaml
matrix_data:
   # 0  1  2  3  4  5  6  7
  - [0, 0, 0, 1, 0, 0, 0, 0]  # 0: h0
  - [0, 0, 0, 1, 0, 0, 0, 0]  # 1: h1
  - [0, 0, 0, 1, 0, 0, 0, 0]  # 2: target protocol sender
  - [1, 1, 1, 0, 1, 0, 0, 0]  # 3: Router0
  - [0, 0, 0, 1, 0, 1, 1, 1]  # 4: Router1
  - [0, 0, 0, 0, 1, 0, 0, 0]  # 5: target protocol receiver
  - [0, 0, 0, 0, 1, 0, 0, 0]  # 6: h0'
  - [0, 0, 0, 0, 1, 0, 0, 0]  # 7: h1'
```

**Legend:**  
- Each row and column is a node.
- A `1` at `[i][j]` means a link from node `i` to node `j`.
- The matrix is symmetric for bidirectional links.

**Bandwidths:**

Fixed 1000 Mbps for all links.

**Delay:**

Fixed 10 ms for all links.

**loss rate:**

The links which are connected to the router have a loss rate of 3% for each direction.
